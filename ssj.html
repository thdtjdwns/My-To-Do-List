<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MY TO-DO LIST (Rainbow Swag)</title>
    <!-- Google Fonts - Bebas Neue (ì œëª©), Roboto (ë³¸ë¬¸) -->
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        :root {
            /* ë¬´ì§€ê°œ ìŠ¤ì›© ì»¬ëŸ¬ íŒ”ë ˆíŠ¸ (ì£¼ìš” ìš”ì†Œ ìƒ‰ìƒ) */
            --primary-color: #ff0000; /* ë¬´ì§€ê°œ ì‹œì‘ (ë¹¨ê°•) */
            --secondary-color: #ff8c00; /* ì£¼í™© */
            --yellow-color: #ffff00; /* ë…¸ë‘ */
            --green-color: #008000; /* ì´ˆë¡ */
            --blue-color: #0000ff; /* íŒŒë‘ */
            --indigo-color: #4b0082; /* ë‚¨ìƒ‰ */
            --violet-color: #ee82ee; /* ë³´ë¼ */

             /* ë°°ê²½ ë° ê¸°ë³¸ ìš”ì†Œ */
            --bg-start-color: #ff0000; /* ë°°ê²½ ê·¸ë¼ë°ì´ì…˜ ì‹œì‘ìƒ‰ (ë¹¨ê°•) */
            --bg-end-color: #ee82ee; /* ë°°ê²½ ê·¸ë¼ë°ì´ì…˜ ëìƒ‰ (ë³´ë¼) */

            --container-bg: rgba(18, 18, 18, 0.9); /* ì‚´ì§ íˆ¬ëª…í•œ ì–´ë‘ìš´ ë°°ê²½ */
            --item-bg: rgba(42, 42, 42, 0.9); /* ì‚´ì§ íˆ¬ëª…í•œ ì–´ë‘ìš´ í•  ì¼ í•­ëª© ë°°ê²½ */

            --text-color: #ffffff; /* ë°ì€ í…ìŠ¤íŠ¸ìƒ‰ */
            --light-text: #cccccc; /* ì—°í•œ í…ìŠ¤íŠ¸ìƒ‰ */
            --completed-text: #a0a0a0; /* ì™„ë£Œ í…ìŠ¤íŠ¸ìƒ‰ */

            --border-color: rgba(255, 255, 255, 0.2); /* ì—°í•œ ë³´ë” ìƒ‰ìƒ */
            --input-bg: rgba(42, 42, 42, 0.8); /* ì…ë ¥ í•„ë“œ ë°°ê²½ìƒ‰ */
            --input-border: rgba(255, 255, 255, 0.3); /* ì…ë ¥ í•„ë“œ ë³´ë” */
            --focus-glow: rgba(255, 255, 255, 0.3); /* í¬ì»¤ìŠ¤ ì‹œ ë¹› íš¨ê³¼ (í°ìƒ‰ ê³„ì—´) */


            /* ë²„íŠ¼ ë° ì¤‘ìš”ë„ ìƒ‰ìƒ (ë¬´ì§€ê°œì—ì„œ ê°€ì ¸ì˜¤ê¸°) */
            --add-button-color: var(--green-color); /* ì¶”ê°€ ë²„íŠ¼ - ì´ˆë¡ */
            --delete-color: var(--primary-color); /* ì‚­ì œ ë²„íŠ¼/ì¤‘ìš”! - ë¹¨ê°• */
            --edit-color: var(--blue-color); /* ìˆ˜ì • ë²„íŠ¼ - íŒŒë‘ */

            --priority-important-color: var(--delete-color); /* ì¤‘ìš”! ë¹¨ê°• */
            --priority-high-color: var(--secondary-color); /* ë†’ìŒ ì£¼í™© */
            --priority-medium-color: var(--yellow-color); /* ë³´í†µ ë…¸ë‘ */
            --priority-low-color: var(--green-color); /* ë‚®ìŒ ì´ˆë¡ */


            /* ì• ë‹ˆë©”ì´ì…˜ ì§€ì† ì‹œê°„ */
            --animation-duration: 0.4s;
        }

        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 20px;
            /* ë¬´ì§€ê°œ ê·¸ë¼ë°ì´ì…˜ ë°°ê²½ */
            background: linear-gradient(45deg,
                        #ff0000 0%, #ff7f00 14%, #ffff00 28%, #00ff00 42%,
                        #0000ff 56%, #4b0082 70%, #9400d3 84%, #ff0000 100%);
            background-size: 200% 200%; /* ë°°ê²½ í¬ê¸° ëŠ˜ë ¤ì„œ ë¶€ë“œëŸ½ê²Œ ì›€ì§ì´ê²Œ */
            animation: rainbow-bg 15s ease infinite; /* ë°°ê²½ ì• ë‹ˆë©”ì´ì…˜ */
            background-attachment: fixed;
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* ë°°ê²½ ì• ë‹ˆë©”ì´ì…˜ í‚¤í”„ë ˆì„ */
        @keyframes rainbow-bg {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }


        .container {
            max-width: 700px;
            margin: 20px auto;
            background-color: var(--container-bg);
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        h1 {
            font-family: 'Bebas Neue', sans-serif;
            text-align: center;
             /* ì œëª©ì— ë¬´ì§€ê°œ ê·¸ë¼ë°ì´ì…˜ í…ìŠ¤íŠ¸ (ì§€ì› ì•ˆë˜ëŠ” ë¸Œë¼ìš°ì € ë§ìŒ) */
             /* background: linear-gradient(45deg, red, orange, yellow, green, blue, indigo, violet);
             -webkit-background-clip: text;
             -webkit-text-fill-color: transparent;
             background-clip: text;
             text-fill-color: transparent; */
            /* ì œëª©ì— ë¬´ì§€ê°œ ê·¸ë¦¼ì íš¨ê³¼ */
            color: var(--text-color); /* í…ìŠ¤íŠ¸ ìƒ‰ìƒì€ í°ìƒ‰ìœ¼ë¡œ */
            text-shadow:
                0 0 5px var(--primary-color), /* ë¹¨ê°• */
                0 0 10px var(--secondary-color), /* ì£¼í™© */
                0 0 15px var(--yellow-color), /* ë…¸ë‘ */
                0 0 20px var(--green-color), /* ì´ˆë¡ */
                0 0 25px var(--blue-color), /* íŒŒë‘ */
                0 0 30px var(--indigo-color), /* ë‚¨ìƒ‰ */
                0 0 35px var(--violet-color); /* ë³´ë¼ */

            margin-bottom: 30px;
            font-size: 3em;
            letter-spacing: 4px;
        }

        .input-area {
            display: flex;
            margin-bottom: 25px;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .input-area input[type="text"],
        .input-area input[type="date"],
        .input-area input[type="time"],
        .input-area select
         {
            flex-grow: 1;
            padding: 12px;
            border: 1px solid var(--input-border);
            border-radius: 4px;
            min-width: 80px;
            font-size: 1em;
            box-sizing: border-box;
            background-color: var(--input-bg);
            color: var(--text-color);
            cursor: pointer;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
         .input-area input[type="text"]:focus,
         .input-area input[type="date"]:focus,
         .input-area input[type="time"]:focus,
         .input-area select:focus {
             outline: none;
             border-color: var(--primary-color); /* í¬ì»¤ìŠ¤ ë³´ë”ìƒ‰ì€ ì¼ë‹¨ ì£¼ìƒ‰ìœ¼ë¡œ */
             box-shadow: 0 0 8px var(--focus-glow); /* í°ìƒ‰ ë¹› íš¨ê³¼ */
         }


        .input-area input[type="time"] {
             flex-grow: 0;
             width: 110px;
             flex-shrink: 0;
        }
         .input-area input[type="date"] {
             flex-grow: 0;
             width: 140px;
             flex-shrink: 0;
         }
        .input-area select {
            flex-grow: 0;
            width: 120px;
            flex-shrink: 0;
             padding: 12px 8px;
        }
        .input-area input[type="text"]#todoInput {
             flex-grow: 2;
             min-width: 150px;
        }
        .input-area input[type="text"]#categoryInput {
             flex-grow: 1;
             min-width: 100px;
        }


        .input-area button {
            padding: 12px 20px;
            background-color: var(--add-button-color); /* ì¶”ê°€ ë²„íŠ¼ ìƒ‰ ë³€ê²½ */
            color: #121212;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease;
            flex-shrink: 0;
            font-size: 1em;
            font-weight: 700;
            text-transform: uppercase;
        }
        .input-area button:hover {
            background-color: #005000; /* í˜¸ë²„ ì‹œ ì‚´ì§ ì§„í•˜ê²Œ (ì´ˆë¡) */
        }
         .input-area button:active {
             transform: scale(0.95);
         }


        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
            flex-wrap: wrap;
            gap: 15px;
        }
        .controls .filter-sort-controls {
             display: flex;
             gap: 10px;
             flex-wrap: wrap;
        }
         .controls select {
             padding: 8px 10px;
             border: 1px solid var(--input-border);
             border-radius: 4px;
             background-color: var(--input-bg);
             color: var(--text-color);
             font-size: 0.9em;
             cursor: pointer;
             flex-shrink: 0;
             transition: border-color 0.3s ease, box-shadow 0.3s ease;
         }
          .controls select:focus {
              outline: none;
              border-color: var(--primary-color); /* í¬ì»¤ìŠ¤ ë³´ë”ìƒ‰ì€ ì¼ë‹¨ ì£¼ìƒ‰ìœ¼ë¡œ */
              box-shadow: 0 0 8px var(--focus-glow); /* í°ìƒ‰ ë¹› íš¨ê³¼ */
          }

         .controls option {
              background-color: #3a3a3a; /* ì˜µì…˜ ë°°ê²½ìƒ‰ì€ ë¬´ì§€ê°œ ë°°ê²½ ë§ê³  ì–´ë‘ìš´ ë‹¨ìƒ‰ìœ¼ë¡œ */
              color: var(--text-color);
         }

        .controls button { /* ì™„ë£Œëœ í•  ì¼ ì§€ìš°ê¸° ë²„íŠ¼ */
             padding: 8px 15px;
             background-color: var(--delete-color); /* ì‚­ì œ ìƒ‰ìƒ ì‚¬ìš© */
             color: white;
             border: none;
             border-radius: 4px;
             cursor: pointer;
             transition: background-color 0.3s ease, transform 0.1s ease;
             font-size: 0.9em;
        }
        .controls button:hover {
            background-color: #c03c51; /* í˜¸ë²„ ì‹œ ì‚´ì§ ì§„í•˜ê²Œ */
        }
        .controls button:active {
             transform: scale(0.95);
         }

        .counts span {
            margin-right: 15px;
            font-size: 0.95em;
            color: var(--light-text);
        }

        .todo-list {
            list-style: none;
            padding: 0;
        }
        .todo-list li {
            background-color: var(--item-bg);
            border: 1px solid var(--border-color);
            padding: 15px;
            margin-bottom: 12px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            word-break: break-word;
            justify-content: space-between;
            gap: 15px;
            flex-wrap: wrap;
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease, opacity var(--animation-duration) ease, margin-bottom var(--animation-duration) ease;
            position: relative;
            opacity: 1;
            transform: translateY(0);
        }
         /* ì¤‘ìš”ë„ë³„ ì™¼ìª½ ë³´ë” ìƒ‰ìƒ - ë¬´ì§€ê°œ ì»¬ëŸ¬ ì‚¬ìš© */
         .todo-list li.priority-important { border-left: 5px solid var(--priority-important-color); padding-left: 10px;}
         .todo-list li.priority-high { border-left: 5px solid var(--priority-high-color); padding-left: 10px;}
         .todo-list li.priority-medium { border-left: 5px solid var(--priority-medium-color); padding-left: 10px;}
         .todo-list li.priority-low { border-left: 5px solid var(--priority-low-color); padding-left: 10px;}
        /* ê¸°ë³¸ ë³´ë” ì™¼ìª½ë„ ë‘ê»˜ ë§ì¶”ê¸° */
         .todo-list li:not([class*="priority-"]) { border-left: 5px solid transparent; padding-left: 10px;}


         .todo-list li:hover {
             transform: translateY(-5px);
             box-shadow: 0 8px 15px rgba(0, 0, 0, 0.6); /* ê·¸ë¦¼ì ë” ì§„í•˜ê²Œ */
             border-color: rgba(255, 255, 255, 0.4); /* í˜¸ë²„ ì‹œ ë³´ë” ì‚´ì§ ë°ê²Œ */
             border-left-color: inherit;
         }

         /* í•­ëª© ì¶”ê°€ ì‹œ ì• ë‹ˆë©”ì´ì…˜ */
         .todo-list li.adding {
              opacity: 0;
              transform: translateY(20px);
         }
          .todo-list li:not(.adding) {
               opacity: 1;
               transform: translateY(0);
          }

         /* í•­ëª© ì‚­ì œ ì‹œ ì• ë‹ˆë©”ì´ì…˜ */
         .todo-list li.removing {
             opacity: 0;
             transform: translateX(50px);
             margin-bottom: -50px;
         }


        .todo-list li .todo-details {
             display: flex;
             flex-direction: column;
             flex-grow: 1;
             min-width: 150px;
             gap: 5px;
        }

         .todo-list li .todo-details .due-info {
             font-size: 0.85em;
             color: var(--light-text);
             font-weight: 500;
             display: flex;
             gap: 8px;
         }

        .todo-list li .todo-details .priority-category-info {
            font-size: 0.85em;
            font-weight: 500;
            display: flex;
            gap: 8px;
             flex-wrap: wrap;
        }
         .todo-list li .todo-details .priority-category-info .priority-label {
             color: var(--light-text); /* ê¸°ë³¸ ë¼ë²¨ ìƒ‰ì€ ì—°í•˜ê²Œ */
         }
         /* ì¤‘ìš”ë„ ë¼ë²¨ ìƒ‰ìƒ */
         .todo-list li.priority-important .todo-details .priority-category-info .priority-label {
             color: var(--priority-important-color);
             font-weight: 700;
         }
          .todo-list li.priority-high .todo-details .priority-category-info .priority-label { color: var(--priority-high-color); }
          .todo-list li.priority-medium .todo-details .priority-category-info .priority-label { color: var(--priority-medium-color); }
          .todo-list li.priority-low .todo-details .priority-category-info .priority-label { color: var(--priority-low-color); }


        .todo-list li .todo-details .category-label {
             color: var(--light-text);
             font-style: italic;
        }


        .todo-list li .todo-text {
            flex-grow: 1;
            font-size: 1em;
            color: var(--text-color);
            font-weight: 500;
             cursor: pointer;
             transition: color var(--animation-duration) ease, text-decoration var(--animation-duration) ease;
        }

        /* ì™„ë£Œëœ í•  ì¼ ìŠ¤íƒ€ì¼ */
        .todo-list li.completed {
            background-color: rgba(58, 58, 58, 0.95); /* ì™„ë£Œ í•­ëª© ë°°ê²½ìƒ‰ ì‚´ì§ ë‹¤ë¥´ê²Œ (ë” íˆ¬ëª…í•˜ê±°ë‚˜ ì§„í•˜ê²Œ) */
            border-color: rgba(90, 90, 90, 0.8);
        }
        .todo-list li.completed .todo-details .due-info,
        .todo-list li.completed .todo-details .priority-category-info,
        .todo-list li.completed .todo-text {
            text-decoration: line-through;
            color: var(--completed-text);
            font-weight: 400;
        }
        /* ì™„ë£Œë˜ì–´ë„ ì™¼ìª½ ë³´ë” ìƒ‰ì€ ìœ ì§€ */
         .todo-list li.completed.priority-important { border-left-color: var(--priority-important-color); }
         .todo-list li.completed.priority-high { border-left-color: var(--priority-high-color); }
         .todo-list li.completed.priority-medium { border-left-color: var(--priority-medium-color); }
         .todo-list li.completed.priority-low { border-left-color: var(--priority-low-color); }


        .todo-list li .actions {
            display: flex;
            gap: 5px;
            flex-shrink: 0;
        }

        .todo-list li .actions button {
            background-color: transparent;
             /* ì•„ì´ì½˜ ìƒ‰ìƒ - ê° ë²„íŠ¼ë³„ ìƒ‰ìƒ ì ìš© */
             color: var(--edit-color); /* ìˆ˜ì • ê¸°ë³¸ ìƒ‰ìƒ */
            border: none;
            padding: 6px 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: color 0.3s ease, transform 0.1s ease;
            font-size: 1.1em;
            line-height: 1;
        }
        .todo-list li .actions button:hover {
            color: #ffffff; /* í˜¸ë²„ ì‹œ í°ìƒ‰ìœ¼ë¡œ */
             background-color: rgba(255, 255, 255, 0.1); /* í˜¸ë²„ ì‹œ ì‚´ì§ ë°°ê²½ìƒ‰ */
        }
         .todo-list li .actions button:active {
             transform: scale(0.9);
         }
        .todo-list li .actions button.delete-btn {
            color: var(--delete-color); /* ì‚­ì œ ì•„ì´ì½˜ ìƒ‰ìƒ */
        }
        .todo-list li .actions button.delete-btn:hover {
            color: #ffffff;
        }
         /* ìˆ˜ì • ëª¨ë“œ ì €ì¥/ì·¨ì†Œ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .edit-area + .actions button {
             background-color: var(--secondary-color); /* ì €ì¥ ë²„íŠ¼ ë¯¼íŠ¸ */
             color: #121212;
             font-size: 0.9em;
             padding: 6px 12px;
        }
         .edit-area + .actions button.cancel-edit-btn {
             background-color: #6c757d; /* ì·¨ì†Œ ë²„íŠ¼ íšŒìƒ‰ */
             color: white;
        }
         .edit-area + .actions button:hover {
              color: white; /* í˜¸ë²„ ì‹œ ê¸€ììƒ‰ í•˜ì–—ê²Œ */
              background-color: #00a896; /* ì €ì¥ */
         }
         .edit-area + .actions button.cancel-edit-btn:hover {
              background-color: #5a6268; /* ì·¨ì†Œ */
         }


        .edit-area {
            display: flex;
            flex-grow: 1;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
            min-width: 200px;
        }
        .edit-area .edit-input[type="text"],
        .edit-area .edit-input[type="date"],
        .edit-area .edit-input[type="time"],
        .edit-area .edit-select {
            flex-grow: 1;
            padding: 6px;
            border: 1px solid var(--input-border);
            border-radius: 4px;
            font-size: 1em;
            min-width: 60px;
            box-sizing: border-box;
            background-color: var(--input-bg);
            color: var(--text-color);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
         .edit-area .edit-input[type="text"]:focus,
         .edit-area .edit-input[type="date"]:focus,
         .edit-area .edit-input[type="time"]:focus,
         .edit-area .edit-select:focus {
             outline: none;
             border-color: var(--primary-color); /* í¬ì»¤ìŠ¤ ë³´ë”ìƒ‰ì€ ì¼ë‹¨ ì£¼ìƒ‰ìœ¼ë¡œ */
             box-shadow: 0 0 8px var(--focus-glow); /* í°ìƒ‰ ë¹› íš¨ê³¼ */
         }

         .edit-area .edit-input[type="time"] {
             width: 90px;
             flex-grow: 0;
             flex-shrink: 0;
         }
         .edit-area .edit-input[type="date"] {
             width: 120px;
             flex-grow: 0;
             flex-shrink: 0;
         }
         .edit-area .edit-select {
             width: 100px;
             flex-grow: 0;
             flex-shrink: 0;
             padding: 6px 4px;
         }
         .edit-area .edit-input[type="text"]:first-child {
             flex-grow: 2;
             min-width: 120px;
         }

    </style>
</head>
<body>
    <div class="container">
        <h1>MY TO-DO LIST</h1>

        <div class="input-area">
            <input type="text" id="todoInput" placeholder="ìƒˆë¡œìš´ í•  ì¼ ì¶”ê°€" onkeypress="handleKeyPress(event)">
            <input type="date" id="dateInput">
            <input type="time" id="timeInput">
            <select id="priorityInput">
                <option value="">ì¤‘ìš”ë„ ì„ íƒ</option>
                <option value="Low">ë‚®ìŒ</option>
                <option value="Medium">ë³´í†µ</option>
                <option value="High">ë†’ìŒ</option>
                <option value="Important">ğŸš¨ ì¤‘ìš”</option>
            </select>
            <input type="text" id="categoryInput" placeholder="#ì¹´í…Œê³ ë¦¬">
            <button onclick="addTodo()">ì¶”ê°€</button>
        </div>

        <div class="controls">
            <div class="counts">
                <span id="totalCount">ì´ í•  ì¼: 0</span>
                <span id="completedCount">ì™„ë£Œ: 0</span>
            </div>
            <div class="filter-sort-controls">
                 <select id="sortSelect" onchange="renderTodos()">
                     <option value="addedDesc">ìµœì‹ ìˆœ</option>
                     <option value="dateAsc">ë§ˆê°ì¼ ë¹ ë¥¸ìˆœ</option>
                     <option value="dateDesc">ë§ˆê°ì¼ ëŠ¦ì€ìˆœ</option>
                     <option value="priorityDesc">ì¤‘ìš”ë„ ë†’ì€ìˆœ</option>
                 </select>
                  <select id="filterSelect" onchange="renderTodos()">
                     <option value="all">ì „ì²´ ë³´ê¸°</option>
                     <option value="incomplete">ë¯¸ì™„ë£Œë§Œ ë³´ê¸°</option>
                     <option value="completed">ì™„ë£Œë§Œ ë³´ê¸°</option>
                 </select>
            </div>
            <button onclick="clearCompleted()">ì™„ë£Œëœ í•  ì¼ ì§€ìš°ê¸°</button>
        </div>


        <ul id="todoList" class="todo-list">
            <!-- í•  ì¼ í•­ëª©ë“¤ì´ ì—¬ê¸°ì— ì¶”ê°€ë  ê±°ì˜ˆìš” -->
        </ul>
    </div>

    <script>
        let todos = [];

        document.addEventListener('DOMContentLoaded', () => {
            loadTodos();
            renderTodos();
            updateCounts();
        });

        function addTodo() {
            const todoInput = document.getElementById('todoInput');
            const dateInput = document.getElementById('dateInput');
            const timeInput = document.getElementById('timeInput');
            const priorityInput = document.getElementById('priorityInput');
            const categoryInput = document.getElementById('categoryInput');

            const todoText = todoInput.value.trim();
            const todoDate = dateInput.value;
            const todoTime = timeInput.value;
            const todoPriority = priorityInput.value || 'Low';
            const todoCategory = categoryInput.value.trim();


            if (todoText === "") {
                alert("í•  ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
                return;
            }

            const newTodo = {
                id: Date.now(),
                text: todoText,
                date: todoDate,
                time: todoTime,
                priority: todoPriority,
                category: todoCategory,
                completed: false
            };

            todos.push(newTodo);

            todoInput.value = "";
            dateInput.value = "";
            timeInput.value = "";
            priorityInput.value = "";
            categoryInput.value = "";


            renderTodos();
            saveTodos();
            updateCounts();
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                addTodo();
            }
        }

        function renderTodos() {
            const todoList = document.getElementById('todoList');
            const sortValue = document.getElementById('sortSelect').value;
            const filterValue = document.getElementById('filterSelect').value;

            let filteredTodos = [...todos];

            if (filterValue === 'incomplete') {
                filteredTodos = filteredTodos.filter(todo => !todo.completed);
            } else if (filterValue === 'completed') {
                filteredTodos = filteredTodos.filter(todo => todo.completed);
            }

            filteredTodos.sort((a, b) => {
                if (sortValue === 'addedDesc') {
                    return b.id - a.id;
                } else if (sortValue === 'dateAsc') {
                    const dateA = a.date || '9999-12-31';
                    const dateB = b.date || '9999-12-31';
                    const timeA = a.time || '23:59';
                    const timeB = b.time || '23:59';

                    if (dateA !== dateB) return dateA.localeCompare(dateB);
                    if (timeA !== timeB) return timeA.localeCompare(timeB);
                    return b.id - a.id;
                } else if (sortValue === 'dateDesc') {
                    const dateA = a.date || '0000-01-01';
                    const dateB = b.date || '0000-01-01';
                    const timeA = a.time || '00:00';
                    const timeB = b.time || '00:00';

                     if (dateB !== dateA) return dateB.localeCompare(dateA);
                     if (timeB !== timeA) return timeB.localeCompare(a.time); // ìˆ˜ì •: a.timeìœ¼ë¡œ ë¹„êµí•´ì•¼ ì˜¬ë°”ë¥¸ ë‚´ë¦¼ì°¨ìˆœ
                    return b.id - a.id;
                }
                else if (sortValue === 'priorityDesc') {
                    const priorityOrder = { 'Important': 4, 'High': 3, 'Medium': 2, 'Low': 1, '': 0 };
                    const priorityA = priorityOrder[a.priority] || 0;
                    const priorityB = priorityOrder[b.priority] || 0;

                    if (priorityB !== priorityA) return priorityB - priorityA;
                    return b.id - a.id;
                }
                return b.id - a.id;
            });

            // ìƒˆë¡œ ê·¸ë¦´ í•­ëª©ë“¤ì˜ IDë§Œ ë¯¸ë¦¬ ê°€ì ¸ì˜´
            const filteredTodoIds = new Set(filteredTodos.map(todo => todo.id));
             const todoItems = todoList.querySelectorAll('li');

             // í˜„ì¬ DOMì— ìˆì§€ë§Œ í•„í„°ë§ëœ ëª©ë¡ì— ì—†ëŠ” í•­ëª©ë“¤ì„ ì‚­ì œ ì• ë‹ˆë©”ì´ì…˜ ì ìš©
             todoItems.forEach(item => {
                 const id = parseInt(item.dataset.id);
                 if (!filteredTodoIds.has(id)) {
                      // items to remove animation
                     item.classList.add('removing');
                      item.addEventListener('transitionend', () => item.remove(), { once: true });
                      // Fallback for transitionend
                      const duration = parseFloat(getComputedStyle(item).transitionDuration) * 1000;
                      setTimeout(() => { if (item.parentElement) item.remove(); }, duration + 50);
                 }
             });


            // í•„í„°ë§ ë° ì •ë ¬ëœ ëª©ë¡ì„ ìƒˆë¡œ ê·¸ë¦¼
             // ê¸°ì¡´ í•­ëª© ì¤‘ ë‚¨ëŠ” ê²ƒë“¤ì€ ê·¸ëŒ€ë¡œ ë‘ê³ , ì—†ì–´ì§„ ê²ƒë§Œ ì§€ìš°ëŠ” ë¡œì§ì´ ë” ë¶€ë“œëŸ¬ì›€.
             // í•˜ì§€ë§Œ í˜„ì¬ renderTodosëŠ” ì „ì²´ë¥¼ ìƒˆë¡œ ê·¸ë¦¬ëŠ” ë°©ì‹ì´ë¯€ë¡œ,
             // ê°„ë‹¨í•˜ê²Œ ê¸°ì¡´ ëª©ë¡ ë¹„ìš°ê³  ìƒˆë¡œ ê·¸ë¦¬ëŠ” ë°©ì‹ ìœ ì§€.
             // ì‚­ì œ ì• ë‹ˆë©”ì´ì…˜ì€ renderTodos ë°– removeTodoì—ì„œ ì²˜ë¦¬í•˜ëŠ”ê²Œ ë” ì¼ë°˜ì .
             // ì¼ë‹¨ renderTodos ë‚´ì—ì„œëŠ” ì¶”ê°€ ì• ë‹ˆë©”ì´ì…˜ë§Œ ì ìš©.

             todoList.innerHTML = ''; // ê¸°ì¡´ ëª©ë¡ ë¹„ìš°ê¸° (ë‹¨ìˆœí™”)


            filteredTodos.forEach(todo => {
                 const listItem = document.createElement('li');
                 listItem.dataset.id = todo.id;

                 // í•­ëª© ì¶”ê°€ ì‹œ ì• ë‹ˆë©”ì´ì…˜ ì ìš©
                 // DOMì— ì¶”ê°€ë˜ê¸° ì „ì— í´ë˜ìŠ¤ë¥¼ ë¶™ì—¬ì•¼ transitionì´ ë°œìƒ
                 // listItem.classList.add('adding'); // ì´ ìœ„ì¹˜ë³´ë‹¤ëŠ” appendChild ì§ì „ì— ë˜ëŠ” ì§í›„ requestAnimationFrame ì‚¬ìš©

                 // ì¤‘ìš”ë„ í´ë˜ìŠ¤ ë° ì™„ë£Œ ìƒíƒœ í´ë˜ìŠ¤ ì¶”ê°€
                 listItem.classList.add(`priority-${todo.priority ? todo.priority.toLowerCase() : 'none'}`);
                 if (todo.completed) {
                     listItem.classList.add('completed');
                 }

                 const todoDetailsDiv = document.createElement('div');
                 todoDetailsDiv.classList.add('todo-details');

                  const dueInfoDiv = document.createElement('div');
                  dueInfoDiv.classList.add('due-info');
                   if(todo.date) {
                      const dateSpan = document.createElement('span');
                      dateSpan.classList.add('due-date');
                      dateSpan.textContent = todo.date.replace(/-/g, '.');
                      dueInfoDiv.appendChild(dateSpan);
                   }
                  if(todo.time) {
                     const timeSpan = document.createElement('span');
                     timeSpan.classList.add('due-time');
                     timeSpan.textContent = todo.time;
                     dueInfoDiv.appendChild(timeSpan);
                  }
                 if (dueInfoDiv.hasChildNodes()) {
                      todoDetailsDiv.appendChild(dueInfoDiv);
                 }


                  const metaInfoDiv = document.createElement('div');
                  metaInfoDiv.classList.add('priority-category-info');
                   if(todo.priority) {
                      const prioritySpan = document.createElement('span');
                      prioritySpan.classList.add('priority-label');
                      let priorityText = todo.priority;
                      if (todo.priority === 'Important') priorityText = 'ğŸš¨ ì¤‘ìš”';
                      else if (todo.priority === 'High') priorityText = 'ğŸ”º ë†’ìŒ';
                      else if (todo.priority === 'Medium') priorityText = 'ğŸ”¹ ë³´í†µ';
                      else if (todo.priority === 'Low') priorityText = 'ğŸ”» ë‚®ìŒ';
                      prioritySpan.textContent = priorityText;
                      metaInfoDiv.appendChild(prioritySpan);
                   }
                   if(todo.category) {
                      const categorySpan = document.createElement('span');
                      categorySpan.classList.add('category-label');
                      categorySpan.textContent = `#${todo.category}`;
                      metaInfoDiv.appendChild(categorySpan);
                   }
                  if (metaInfoDiv.hasChildNodes()) {
                      todoDetailsDiv.appendChild(metaInfoDiv);
                  }


                 const todoTextSpan = document.createElement('span');
                 todoTextSpan.classList.add('todo-text');
                 todoTextSpan.textContent = todo.text;
                 todoTextSpan.onclick = () => toggleComplete(todo.id);
                 todoDetailsDiv.appendChild(todoTextSpan);


                 const actionsDiv = document.createElement('div');
                 actionsDiv.classList.add('actions');

                 // ì•„ì´ì½˜ ë²„íŠ¼ìœ¼ë¡œ ë³€ê²½
                 const editButton = document.createElement('button');
                 editButton.classList.add('edit-btn');
                 editButton.innerHTML = '<i class="fas fa-edit"></i>';
                 editButton.onclick = () => editTodo(todo.id);

                 const deleteButton = document.createElement('button');
                 deleteButton.classList.add('delete-btn');
                 deleteButton.innerHTML = '<i class="fas fa-trash-alt"></i>';
                 deleteButton.onclick = () => removeTodo(todo.id);

                 actionsDiv.appendChild(editButton);
                 actionsDiv.appendChild(deleteButton);

                 listItem.appendChild(todoDetailsDiv);
                 listItem.appendChild(actionsDiv);


                 // ì• ë‹ˆë©”ì´ì…˜ì„ ìœ„í•´ appendChild ì§ì „ì— adding í´ë˜ìŠ¤ ì¶”ê°€
                 listItem.classList.add('adding');
                 todoList.appendChild(listItem);

                 // DOMì— ì¶”ê°€ëœ í›„ ì• ë‹ˆë©”ì´ì…˜ í´ë˜ìŠ¤ ì œê±°í•˜ì—¬ íŠ¸ëœì§€ì…˜ ë°œìƒ
                 requestAnimationFrame(() => {
                    listItem.classList.remove('adding');
                 });
            });
        }

        function removeTodo(id) {
            const listItem = document.querySelector(`li[data-id='${id}']`);
            if (listItem) {
                // ì‚­ì œ ì• ë‹ˆë©”ì´ì…˜ í´ë˜ìŠ¤ ì¶”ê°€
                listItem.classList.add('removing');

                // ì• ë‹ˆë©”ì´ì…˜ ì¢…ë£Œ í›„ ì‹¤ì œ DOM ìš”ì†Œ ì‚­ì œ ë° ë°ì´í„° ì—…ë°ì´íŠ¸
                listItem.addEventListener('transitionend', () => {
                    if (listItem.parentElement) { // ë¶€ëª¨ ìš”ì†Œê°€ ìˆëŠ”ì§€ ë‹¤ì‹œ í™•ì¸
                         listItem.remove(); // DOMì—ì„œ ìš”ì†Œ ì‚­ì œ
                         todos = todos.filter(todo => todo.id !== id); // ë°°ì—´ì—ì„œë„ ì‚­ì œ
                         saveTodos();
                         updateCounts();
                    }
                }, { once: true }); // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ í•œ ë²ˆë§Œ ì‹¤í–‰ë˜ë„ë¡ ì˜µì…˜ ì¶”ê°€

                // ë§Œì•½ transitionend ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ì§€ ì•Šì„ ê²½ìš°ë¥¼ ëŒ€ë¹„ (fallback)
                 const duration = parseFloat(getComputedStyle(listItem).transitionDuration) * 1000;
                 setTimeout(() => {
                    if (listItem.parentElement) {
                        listItem.remove();
                        todos = todos.filter(todo => todo.id !== id);
                        saveTodos();
                        updateCounts();
                    }
                 }, duration + 50);

            } else {
                 // listItemì´ ì—†ëŠ” ê²½ìš° (ì´ë¯¸ ì‚­ì œë˜ì—ˆê±°ë‚˜ ì˜¤ë¥˜)
                 todos = todos.filter(todo => todo.id !== id);
                 saveTodos();
                 updateCounts();
                 renderTodos(); // í˜¹ì‹œ ëª¨ë¥´ë‹ˆ ëª©ë¡ ì „ì²´ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
            }
        }

        function toggleComplete(id) {
            const todo = todos.find(todo => todo.id === id);
            if (todo) {
                todo.completed = !todo.completed;
                const listItem = document.querySelector(`li[data-id='${id}']`);
                if (listItem) {
                     listItem.classList.toggle('completed', todo.completed);
                }
                saveTodos();
                updateCounts();
            }
        }

        function editTodo(id) {
            const listItem = document.querySelector(`li[data-id='${id}']`);
            const todoDetailsDiv = listItem.querySelector('.todo-details');
            const actionsDiv = listItem.querySelector('.actions');

            if (listItem.querySelector('.edit-area')) {
                return;
            }

            const todo = todos.find(todo => todo.id === id);
            if (!todo) return;

             // ê¸°ì¡´ actions ë²„íŠ¼ ìˆ¨ê¹€
            actionsDiv.style.display = 'none';


            const editArea = document.createElement('div');
            editArea.classList.add('edit-area');

            const editTextInput = document.createElement('input');
            editTextInput.type = 'text';
            editTextInput.className = 'edit-input';
            editTextInput.value = todo.text;
            editTextInput.placeholder = "í•  ì¼ ë‚´ìš©";

            const editDateInput = document.createElement('input');
            editDateInput.type = 'date';
            editDateInput.className = 'edit-input';
            editDateInput.value = todo.date;

            const editTimeInput = document.createElement('input');
            editTimeInput.type = 'time';
            editTimeInput.className = 'edit-input';
            editTimeInput.value = todo.time;

            const editPrioritySelect = document.createElement('select');
             editPrioritySelect.className = 'edit-select';
             const priorities = [{value: '', text: 'ì¤‘ìš”ë„ ì„ íƒ'}, {value: 'Low', text: 'ë‚®ìŒ'}, {value: 'Medium', text: 'ë³´í†µ'}, {value: 'High', text: 'ë†’ìŒ'}, {value: 'Important', text: 'ğŸš¨ ì¤‘ìš”'}];
             priorities.forEach(p => {
                 const option = document.createElement('option');
                 option.value = p.value;
                 option.textContent = p.text;
                 if (todo.priority === p.value) {
                     option.selected = true;
                 }
                 editPrioritySelect.appendChild(option);
             });

            const editCategoryInput = document.createElement('input');
            editCategoryInput.type = 'text';
            editCategoryInput.className = 'edit-input';
            editCategoryInput.value = todo.category;
            editCategoryInput.placeholder = "#ì¹´í…Œê³ ë¦¬";


            editArea.appendChild(editTextInput);
            editArea.appendChild(editDateInput);
            editArea.appendChild(editTimeInput);
            editArea.appendChild(editPrioritySelect);
            editArea.appendChild(editCategoryInput);


             // ì €ì¥ ë° ì·¨ì†Œ ë²„íŠ¼ ì¶”ê°€
             const saveButton = document.createElement('button');
             saveButton.textContent = 'ì €ì¥';
             saveButton.onclick = () => saveEditedTodo(id, editTextInput.value, editDateInput.value, editTimeInput.value, editPrioritySelect.value, editCategoryInput.value);

             const cancelButton = document.createElement('button');
             cancelButton.textContent = 'ì·¨ì†Œ';
             cancelButton.classList.add('cancel-edit-btn'); // ì·¨ì†Œ ë²„íŠ¼ í´ë˜ìŠ¤
             cancelButton.onclick = () => {
                 renderTodos(); // ëª©ë¡ ë‹¤ì‹œ ê·¸ë ¤ì„œ ìˆ˜ì • ëª¨ë“œ í•´ì œ
                 // actionsDiv.style.display = 'flex'; // renderTodosê°€ ì•Œì•„ì„œ ì²˜ë¦¬í•¨
             };

            const editActionsDiv = document.createElement('div');
            editActionsDiv.classList.add('actions'); // actions ìŠ¤íƒ€ì¼ ì¬í™œìš©
             editActionsDiv.appendChild(saveButton);
             editActionsDiv.appendChild(cancelButton);


            todoDetailsDiv.style.display = 'none'; // ê¸°ì¡´ ìƒì„¸ ì •ë³´ ìˆ¨ê¹€
            listItem.insertBefore(editArea, actionsDiv); // ìˆ˜ì • ì˜ì—­ ì‚½ì…
            listItem.insertBefore(editActionsDiv, actionsDiv); // ì €ì¥/ì·¨ì†Œ ë²„íŠ¼ ì˜ì—­ ì‚½ì…


            editTextInput.focus();

            const inputsInEditArea = editArea.querySelectorAll('input, select');
             inputsInEditArea.forEach(input => {
                 input.onkeypress = (event) => {
                    if (event.key === 'Enter') {
                        saveEditedTodo(
                            id,
                            editTextInput.value,
                            editDateInput.value,
                            editTimeInput.value,
                            editPrioritySelect.value,
                            editCategoryInput.value
                         );
                    }
                 };
             });
        }

        function saveEditedTodo(id, newText, newDate, newTime, newPriority, newCategory) {
             const newTrimmedText = newText.trim();

            if (newTrimmedText === "") {
                alert("í•  ì¼ ë‚´ìš©ì„ ë¹„ì›Œë‘˜ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!");
                renderTodos(); // ì…ë ¥ ì·¨ì†Œ ì‹œ ëª©ë¡ ë‹¤ì‹œ ê·¸ë ¤ì„œ ìˆ˜ì • ëª¨ë“œ í•´ì œ
                return;
            }

            const todo = todos.find(todo => todo.id === id);
            if (todo) {
                todo.text = newTrimmedText;
                todo.date = newDate;
                todo.time = newTime;
                todo.priority = newPriority || 'Low';
                todo.category = newCategory.trim();


                renderTodos(); // ëª©ë¡ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
                saveTodos();
                 updateCounts();
            }
        }

        function clearCompleted() {
            if(confirm("ì™„ë£Œëœ í•  ì¼ì„ ëª¨ë‘ ì§€ìš¸ê¹Œìš”?")) {
                 const completedTodos = todos.filter(todo => todo.completed);
                 if (completedTodos.length > 0) {
                      todos = todos.filter(todo => !todo.completed);
                      saveTodos();
                      updateCounts();
                      renderTodos(); // ì „ì²´ ëª©ë¡ ë‹¤ì‹œ ê·¸ë ¤ì„œ ì™„ë£Œ í•­ëª© ì œê±°
                 } else {
                     alert("ì™„ë£Œëœ í•  ì¼ì´ ì—†ìŠµë‹ˆë‹¤.");
                 }
            }
        }

        function updateCounts() {
            const totalCountSpan = document.getElementById('totalCount');
            const completedCountSpan = document.getElementById('completedCount');

            const total = todos.length;
            const completed = todos.filter(todo => todo.completed).length;

            totalCountSpan.textContent = `ì´ í•  ì¼: ${total}`;
            completedCountSpan.textContent = `ì™„ë£Œ: ${completed}`;
        }

        function saveTodos() {
            localStorage.setItem('myTodos', JSON.stringify(todos));
        }

        function loadTodos() {
            const savedTodos = localStorage.getItem('myTodos');
            if (savedTodos) {
                todos = JSON.parse(savedTodos);
                todos = todos.map(todo => ({
                    ...todo,
                    date: todo.date || '',
                    time: todo.time || '',
                    priority: todo.priority || 'Low',
                    category: todo.category || '',
                }));
            } else {
                todos = [];
            }
        }

    </script>
</body>
</html>
